STRINGS = {
    'en': {
        'choose_language': "Please choose your language:",
        'language_set': "Language set to English.",
        'send_voice_check': "Excellent! Send me a voice message at least 5 seconds long to check.",
        'start': "Please choose your language to start:",
        'start_brief': "Hello! I make instant readable summaries of voice messages in Telegram. In the free version, you need to forward them to me, in the paid version you can add me directly to group chats.",
        'settings': "⚙️ Bot Settings",
        'processing': "Processing your voice...",
        'error': "An error occurred while processing your file. Please try again later.",
        'invalid_file': "Please send an MP3 or WAV file.",
        'file_too_large': "The file is too large. Please send a file smaller than 20MB.",
        'subscription_info': "*Free Plan*:\n• Unlimited voice transcriptions in direct chats\n• Multiple summarization modes\n• Audio file conversion\n\n*Pro Plan (200₽/month)*:\n• All Free Plan features\n• Add the bot to up to 3 group chats\n• All members in those groups can use the bot\n• Only one person needs to subscribe\n\nTo subscribe, contact @kirniy",
        'group_limit_reached': "This bot can only be used in direct messages or in groups with an active Pro subscription. The current subscriber has reached the 3 group limit.",
        'help': "*Commands:*\nstart, help, settings, pause, resume\n\n*Features:*\n• Voice to text transcription\n• Multiple summary modes\n• MP3/WAV conversion\n• Message history\n\n*Modes:*\nBrief, Detailed, Bullet Points, Combined, As Is, Unhinged 18+\n\nContact @kirniy for Pro subscription",
        'pause_success': "*Bot Paused*\n\nThe bot has been paused for this chat. It will no longer process voice messages or commands until resumed.\n\nUse /resume to enable it again when needed.",
        'resume_success': "*Bot Resumed*\n\nThe bot has been resumed for this chat. It will now process voice messages and commands normally.",
        'settings_help': "Help",
        'history_delete': "Delete History",
        'history_delete_confirm': "Are you sure you want to delete all voice message history for this chat? This action is irreversible.",
        'history_delete_yes': "Yes, Delete",
        'history_delete_cancel': "Cancel",
        'history_deleted': "Chat history deleted.",
        'history_delete_error': "Error deleting history.",
        'history_export': "Export History",
        'history_exporting': "Generating history export...",
        'history_export_complete': "History export complete. Check the file below.",
        'history_export_empty': "No history found to export.",
        'history_export_error': "Error generating history export."
    },
    'ru': {
        'choose_language': "Пожалуйста, выберите ваш язык:",
        'language_set': "Язык установлен на Русский.",
        'send_voice_check': "Отлично! Пришлите мне войс длиной от 5 секунд для проверки.",
        'start': "Пожалуйста, выберите ваш язык для начала:",
        'start_brief': "Привет! Я делаю моментальные читаемые саммари голосовых сообщений в Telegram. В бесплатной версии их нужно пересылать мне, в платной можно добавить меня прямо в групповые чаты.",
        'settings': "⚙️ Настройки бота",
        'processing': "Обрабатываю ваш войс...",
        'error': "Произошла ошибка при обработке вашего файла. Пожалуйста, попробуйте позже.",
        'invalid_file': "Пожалуйста, отправьте файл в формате MP3 или WAV.",
        'file_too_large': "Файл слишком большой. Пожалуйста, отправьте файл размером менее 20МБ.",
        'subscription_info': "*Бесплатный план*:\n• Неограниченные расшифровки голосовых в личных чатах\n• Несколько режимов резюмирования\n• Конвертация аудиофайлов\n\n*Pro план (200₽/месяц)*:\n• Все функции бесплатного плана\n• Добавление бота в до 3-х групповых чатов\n• Все участники этих групп могут использовать бота\n• Подписка требуется только одному человеку\n\nДля подписки свяжитесь с @kirniy",
        'group_limit_reached': "Этот бот можно использовать только в личных сообщениях или в группах с активной Pro подпиской. Текущий подписчик достиг лимита в 3 группы.",
        'help': "*Команды:*\nстарт, помощь, настройки, пауза, продолжить\n\n*Функции:*\n• Голос в текст\n• Несколько режимов саммари\n• Конвертация MP3/WAV\n• История сообщений\n\n*Режимы:*\nКратко, Подробно, Тезисно, Комбо, Как есть, Паша Техник 18+\n\nДля Pro подписки: @kirniy",
        'pause_success': "*Бот приостановлен*\n\nБот был приостановлен для этого чата. Он больше не будет обрабатывать голосовые сообщения или команды до возобновления.\n\nИспользуйте /resume для повторного включения, когда это потребуется.",
        'resume_success': "*Бот возобновлен*\n\nБот был возобновлен для этого чата. Теперь он будет обрабатывать голосовые сообщения и команды в обычном режиме.",
        'settings_help': "Помощь",
        'history_delete': "Удалить историю",
        'history_delete_confirm': "Вы уверены, что хотите удалить всю историю голосовых сообщений для этого чата? Это действие необратимо.",
        'history_delete_yes': "Да, удалить",
        'history_delete_cancel': "Отмена",
        'history_deleted': "История чата удалена.",
        'history_delete_error': "Ошибка при удалении истории.",
        'history_export': "Экспорт истории",
        'history_exporting': "Генерирую экспорт истории...",
        'history_export_complete': "Экспорт истории завершен. Проверьте файл ниже.",
        'history_export_empty': "История для экспорта не найдена.",
        'history_export_error': "Ошибка при генерации экспорта истории.",
        'redo_processing': "Переделываю сводку..."
    },
    'kk': {
        'choose_language': "Тілді таңдаңыз:",
        'language_set': "Қазақ тілі таңдалды.",
        'send_voice_check': "Жақсы! Тексеру үшін маған 5 секундтан асатын дауыстық хабарлама жіберіңіз.",
        'start': "Бастау үшін тілді таңдаңыз:",
        'start_brief': "Сәлем! Мен Telegram-да дауыстық хабарламалардың лезде оқылатын қысқаша мазмұнын жасаймын. Тегін нұсқада оларды маған қайта жіберу керек, ақылы нұсқада мені топтық чаттарға тікелей қосуға болады.",
        'settings': "⚙️ Бот параметрлері",
        'processing': "Файлыңыз өңделуде...",
        'error': "Файлыңызды өңдеу кезінде қате орын алды. Кейінірек қайталап көріңіз.",
        'invalid_file': "MP3 немесе WAV форматындағы файлды жіберіңіз.",
        'file_too_large': "Файл тым үлкен. 20МБ-тан кіші файлды жіберіңіз.",
        'subscription_info': "*Тегін жоспар*:\n• Жеке чаттарда шексіз дауыстық транскрипция\n• Бірнеше түйіндеу режимдері\n• Аудио файлдарын түрлендіру\n\n*Pro жоспар (айына 200₽)*:\n• Барлық тегін жоспар мүмкіндіктері\n• Ботты 3 топтық чатқа дейін қосу\n• Осы топтардағы барлық мүшелер ботты пайдалана алады\n• Тек бір адам жазылу керек\n\nЖазылу үшін @kirniy хабарласыңыз",
        'group_limit_reached': "Бұл ботты тек жеке хабарламаларда немесе белсенді Pro жазылымы бар топтарда пайдалануға болады. Ағымдағы жазылушы 3 топ шегіне жетті.",
        'help': "*Командалар:*\nstart, help, settings, pause, resume\n\n*Функциялар:*\n• Дауысты мәтінге\n• Бірнеше түйіндеме режимі\n• MP3/WAV түрлендіру\n• Хабарлама тарихы\n\n*Режимдер:*\nҚысқаша, Толық, Тезистер, Біріктірілген, Бар күйінде, Паша Техник 18+\n\nPro жазылым үшін: @kirniy",
        'pause_success': "*Бот кідіртілді*\n\nБот бұл чат үшін кідіртілді. Қайта қосылғанға дейін ол дауыстық хабарламаларды немесе командаларды өңдемейді.\n\nҚажет болған кезде қайта қосу үшін /resume командасын пайдаланыңыз.",
        'resume_success': "*Бот қайта қосылды*\n\nБот бұл чат үшін қайта қосылды. Енді ол дауыстық хабарламаларды және командаларды қалыпты режимде өңдейді.",
        'settings_help': "Көмек",
        'history_delete': "Тарихты жою",
        'history_delete_confirm': "Осы чаттың барлық дауыстық хабарлама тарихын жойғыңыз келетініне сенімдісіз бе? Бұл әрекет қайтарымсыз.",
        'history_delete_yes': "Иә, жою",
        'history_delete_cancel': "Болдырмау",
        'history_deleted': "Чат тарихы жойылды.",
        'history_delete_error': "Тарихты жою кезінде қате.",
        'history_export': "Тарихты экспорттау",
        'history_exporting': "Тарих экспорты жасалуда...",
        'history_export_complete': "Тарих экспорты аяқталды. Төмендегі файлды тексеріңіз.",
        'history_export_empty': "Экспорттауға тарих табылмады.",
        'history_export_error': "Тарих экспортын жасау кезінде қате.",
        'redo_processing': "Переделываю сводку..."
    }
}

# Bot description
BOT_DESCRIPTION = {
    'en': "Voicio | Summary Bot\nTransform voice to text → Clean transcription → Structure by topics and output → 3 modes: brief | detailed | original → Save history. Works in group chats",
    'ru': "Voicio | Саммари Бот\nПреобразую голосовые в текст → Чистая расшифровка → Структура по темам и вывод → 3 режима: тезисно | кратко | оригинал → Сохраняю историю. Работаю в групповых чатах",
    'kk': "Voicio | Түйіндеме боты\nДауысты мәтінге айналдырамын → Таза транскрипция → Тақырыптар бойынша құрылым және шығару → 3 режим: тезистік | қысқаша | түпнұсқа → Тарихты сақтаймын. Топтық чаттарда жұмыс істеймін"
}

# Create a mapping of language codes to their display names and emojis
LANGUAGES = {
    'en': {'name': 'English', 'emoji': ''},
    'ru': {'name': 'Русский', 'emoji': ''},
    'kk': {'name': 'Қазақша', 'emoji': ''}
}

# Track user language preferences in memory (could be moved to database)
user_language = {}

def get_dual_string(key: str) -> str:
    """Returns a string with both English and Russian versions."""
    en_text = STRINGS.get('en', {}).get(key, f"[{key}_en?]") # Fallback
    ru_text = STRINGS.get('ru', {}).get(key, f"[{key}_ru?]") # Fallback
    # Use a separator for clarity
    return f"{en_text}\n{'-'*20}\n{ru_text}"

def get_string(key: str, language: str) -> str:
    """Returns a string for the specified language."""
    if language not in STRINGS:
        language = 'en'  # Default to English if language not found
    
    return STRINGS.get(language, {}).get(key, f"[{key}_{language}?]")

def set_user_language(user_id: int, language: str) -> bool:
    """Sets a user's preferred language."""
    if language in STRINGS:
        user_language[user_id] = language
        return True
    return False

def get_user_language(user_id: int) -> str:
    """Gets a user's preferred language or returns the default."""
    return user_language.get(user_id, 'ru')  # Default to Russian 